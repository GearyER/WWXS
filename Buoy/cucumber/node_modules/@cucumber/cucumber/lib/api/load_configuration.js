"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadConfiguration = void 0;
const locate_file_1 = require("../configuration/locate_file");
const configuration_1 = require("../configuration");
const validate_configuration_1 = require("../configuration/validate_configuration");
const convert_configuration_1 = require("./convert_configuration");
const environment_1 = require("./environment");
/**
 * Load user-authored configuration to be used in a test run.
 *
 * @public
 * @param options - Coordinates required to find configuration.
 * @param environment - Project environment.
 */
async function loadConfiguration(options = {}, environment = {}) {
    var _a;
    const { cwd, env } = (0, environment_1.mergeEnvironment)(environment);
    const configFile = (_a = options.file) !== null && _a !== void 0 ? _a : (0, locate_file_1.locateFile)(cwd);
    const profileConfiguration = configFile
        ? await (0, configuration_1.fromFile)(cwd, configFile, options.profiles)
        : {};
    const original = (0, configuration_1.mergeConfigurations)(configuration_1.DEFAULT_CONFIGURATION, profileConfiguration, options.provided);
    (0, validate_configuration_1.validateConfiguration)(original);
    const runnable = await (0, convert_configuration_1.convertConfiguration)(original, env);
    return {
        useConfiguration: original,
        runConfiguration: runnable,
    };
}
exports.loadConfiguration = loadConfiguration;
//# sourceMappingURL=load_configuration.js.map